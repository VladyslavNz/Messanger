  generator client {
    provider = "prisma-client-js"
  }

  datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
  }

  model Users {
    id Int @id @default(autoincrement())
    username String @unique
    email String @unique
    password String 
    role Role @default(USER)
    created_at DateTime @default(now())
    sendMessages Messages[] @relation("SentMessages")
    privateChats1 PrivateChats[] @relation("ChatUser1")
    privateChats2 PrivateChats[] @relation("ChatUser2")
    hash_token RefreshToken[]
    isBanned  Boolean @default(false)
    banReason String? 

  }

  model RefreshToken {
    id Int @id @default(autoincrement())
    user_id Int
    user Users @relation(fields: [user_id], references: [id], onDelete: Cascade)
    hash_token String @unique
    revoked Boolean @default(false)
    expires_in DateTime
    created_at DateTime @default(now())
    @@index([user_id])
    @@index([expires_in])
  }

  enum Role {
    USER
    ADMIN
  }


  model PrivateChats {
    id Int @id @default(autoincrement())
    user1_id Int
    user2_id Int
    deleted_for_user1 Boolean @default(false)
    deleted_for_user2 Boolean @default(false)
    user1 Users @relation("ChatUser1", fields: [user1_id], references: [id], onDelete: Cascade)
    user2 Users @relation("ChatUser2", fields: [user2_id], references: [id], onDelete: Cascade)
    messages Messages[]
    created_at DateTime @updatedAt
    @@unique([user1_id, user2_id])
    @@index([user1_id])
    @@index([user2_id])
  }

  model Messages {
    id Int @id @default(autoincrement())
    chat_id Int
    sender_id Int
    message String
    created_at DateTime @default(now())

    chat PrivateChats @relation(fields: [chat_id], references: [id], onDelete: Cascade)
    sender Users @relation("SentMessages", fields: [sender_id], references: [id], onDelete: Cascade)
  }